import requests
import os
from bs4 import BeautifulSoup

sessionId='xxx'#put session id here

headers = {'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8',
'Accept-Encoding': 'gzip, deflate, br',
'Accept-Language': 'en-US,en;q=0.5',
'Cache-Control': 'max-age=0',
'Connection': 'keep-alive',
'Cookie':f'MoodleSession={sessionId}',
'Host': 'lionel2.kgv.edu.hk',
'If-Modified-Since':'Wed, 26 Jan 2022 21:05:40 GMT',
'If-None-Match':"96ca96156b3a3c907a0a19359e2168a80229e900",
'Sec-Fetch-Dest':'document',
'Sec-Fetch-Mode':'navigate',
'Sec-Fetch-Site':'cross-site',
'Sec-Fetch-User':'?1',
'Upgrade-Insecure-Requests': '1',
'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:95.0) Gecko/20100101 Firefox/95.0'}

def link(id):
    return f'https://lionel2.kgv.edu.hk/user/view.php?id={id}&course=3982'

for i in range(0,1500):
    page=requests.get(link(i),headers=headers)

    soup = BeautifulSoup(page.text, 'html.parser')

    images=soup.find_all('img')

    if not images: #error catching
        continue

    else:
        image=images[0]['src']
        if not image.startswith('https://lionel2.kgv.edu.hk/pluginfile.php/'): #means that it found an error page; id isn't correlated with a teacher
            print(f'{i} - fail')
        
        else:
            name = (soup.find_all('title')[0].contents[0][33:])

            if name[0:2]=='Ms' or name[0:2] == 'Mr': #gotta get those first names
                name=name[3:]
            
            os.mkdir(f'Teacher-Data/{name}')

            imageLink=images[0]['src'].replace('f1','f3') #f1 gives mid photos, f3 is higher res

            photo = requests.get(imageLink,headers=headers) #getting photo from photo link

            file = open(f"teachers/{name}/photo.jpg", "wb")
            file.write(photo.content)
            file.close()

            file=open(f"teachers/{name}/ID.txt",'w')
            file.write(f'ID ----- {str(i)}\nPhoto Link ----- {imageLink}')

            print(f'{i} - {name} - complete')

